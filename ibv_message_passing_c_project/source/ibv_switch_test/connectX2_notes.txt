== Introduction ==

Notes about using a ConnectX-2 VPI configured with an Ethernet link-layer for perfoming the switch-test function
initially developed in https://github.com/chester-gillon/switch_test using PCAP to transmit/receive raw frames.

The test environment was:
a. A HP Z640 workstation, with dual E5-2620 v3 processors.
b. Ubuntu 18.04.6 LTS with a 4.15.0-163-generic Kernel.
c. A Mellanox ConnectX-2 MHQH29C with firmware 2.9.1000 (the latest available for PSID MT_0FC0110009).
d. No specific real-time programming techniques.
e. The ubuntu_mlx4_to_eth.sh script to switch the ConnectX-2 ports from Infiniband to Ethernet after Linux has booted.
f. A tp-link T1700G-28TQ as the injection switch with:
   - 10G ports 27 and 28 connected to the ConnectX-2 ports 1 and 2.
   - 10G ports 25 and 26 connected by a DAC cable, as a loop-back for maximum throughput at 10G.
   - 10/100/1000M ports ports 1 and 24 connected to the tp-Link TL-SF1024 10/100M unmanaged switch.
   - Ports 1 to 26 being untagged members of one VLAN 1001 .. 1026 each.
   - Ports 27 and 28 being tagged members of all VLANs 1001 .. 1026.

Each test frames takes a total of 12336 bit-times which includes
  preamble + Start frame delimiter + frame + Frame check sequence + Interpacket gap 


== ibv_raw_packet_tx rate ==

The following shows the average transmit rate achieved by ibv_raw_packet_tx over 10 seconds;
$ ibv_switch_test/ibv_raw_packet_tx  -i mlx4_0 -n 1 -p 25,26
Send 8096001 frames over 10.000094 secs, average 809592.5 Hz

On a 10G link the expected rate for the size of the frames used in 810635, so 99.87% of the thoeretical
line rate.


== Behaviour of different Queue-Pairs with VLANs ==

For the Queue-Pair types which are built upon RDMA, RoCE GIDs are used to select the source and destination addresses.

The add_vlans_for_switch_test.sh script was used to map a GID to a VLAN / MAC address / IPv6 link-local address combination.

While the PCAP based switch_test could use a single Ethernet interface for transmit and receive, with unicast Queue-Pairs
if both ends are on the same interface then no packets are output; it seems the packets are looped internally.
That happens even with the IBV_QPT_UD even when source and destination GIDS are different.

Therefore, if Queue-Pairs are to be used then need separate transmit and receive interfaces.
The same range of VLANs are mapped to two interfaces, but with different MAC addresses and GIDs on each interface.

The output from the script which adds VLANs on both ConnectX-2 ports:
$ sudo ./ibv_message_passing_c_project/source/ibv_switch_test/add_vlans_for_switch_test.sh ens5 0 ; sudo ./ibv_message_passing_c_project/source/ibv_switch_test/add_vlans_for_switch_test.sh ens5d1 1
[sudo] password for mr_halfword: 
Added VLAN with VID == 1001 to IF -:ens5:-
Added VLAN with VID == 1002 to IF -:ens5:-
Added VLAN with VID == 1003 to IF -:ens5:-
Added VLAN with VID == 1004 to IF -:ens5:-
Added VLAN with VID == 1005 to IF -:ens5:-
Added VLAN with VID == 1006 to IF -:ens5:-
Added VLAN with VID == 1007 to IF -:ens5:-
Added VLAN with VID == 1008 to IF -:ens5:-
Added VLAN with VID == 1009 to IF -:ens5:-
Added VLAN with VID == 1010 to IF -:ens5:-
Added VLAN with VID == 1011 to IF -:ens5:-
Added VLAN with VID == 1012 to IF -:ens5:-
Added VLAN with VID == 1013 to IF -:ens5:-
Added VLAN with VID == 1014 to IF -:ens5:-
Added VLAN with VID == 1015 to IF -:ens5:-
Added VLAN with VID == 1016 to IF -:ens5:-
Added VLAN with VID == 1017 to IF -:ens5:-
Added VLAN with VID == 1018 to IF -:ens5:-
Added VLAN with VID == 1019 to IF -:ens5:-
Added VLAN with VID == 1020 to IF -:ens5:-
Added VLAN with VID == 1021 to IF -:ens5:-
Added VLAN with VID == 1022 to IF -:ens5:-
Added VLAN with VID == 1023 to IF -:ens5:-
Added VLAN with VID == 1024 to IF -:ens5:-
Added VLAN with VID == 1025 to IF -:ens5:-
Added VLAN with VID == 1026 to IF -:ens5:-
Added VLAN with VID == 1027 to IF -:ens5:-
Added VLAN with VID == 1028 to IF -:ens5:-
Added VLAN with VID == 1029 to IF -:ens5:-
Added VLAN with VID == 1030 to IF -:ens5:-
Added VLAN with VID == 1031 to IF -:ens5:-
Added VLAN with VID == 1032 to IF -:ens5:-
Added VLAN with VID == 1033 to IF -:ens5:-
Added VLAN with VID == 1034 to IF -:ens5:-
Added VLAN with VID == 1035 to IF -:ens5:-
Added VLAN with VID == 1036 to IF -:ens5:-
Added VLAN with VID == 1037 to IF -:ens5:-
Added VLAN with VID == 1038 to IF -:ens5:-
Added VLAN with VID == 1039 to IF -:ens5:-
Added VLAN with VID == 1040 to IF -:ens5:-
Added VLAN with VID == 1041 to IF -:ens5:-
Added VLAN with VID == 1042 to IF -:ens5:-
Added VLAN with VID == 1043 to IF -:ens5:-
Added VLAN with VID == 1044 to IF -:ens5:-
Added VLAN with VID == 1045 to IF -:ens5:-
Added VLAN with VID == 1046 to IF -:ens5:-
Added VLAN with VID == 1047 to IF -:ens5:-
Added VLAN with VID == 1048 to IF -:ens5:-
Added VLAN with VID == 1001 to IF -:ens5d1:-
Added VLAN with VID == 1002 to IF -:ens5d1:-
Added VLAN with VID == 1003 to IF -:ens5d1:-
Added VLAN with VID == 1004 to IF -:ens5d1:-
Added VLAN with VID == 1005 to IF -:ens5d1:-
Added VLAN with VID == 1006 to IF -:ens5d1:-
Added VLAN with VID == 1007 to IF -:ens5d1:-
Added VLAN with VID == 1008 to IF -:ens5d1:-
Added VLAN with VID == 1009 to IF -:ens5d1:-
Added VLAN with VID == 1010 to IF -:ens5d1:-
Added VLAN with VID == 1011 to IF -:ens5d1:-
Added VLAN with VID == 1012 to IF -:ens5d1:-
Added VLAN with VID == 1013 to IF -:ens5d1:-
Added VLAN with VID == 1014 to IF -:ens5d1:-
Added VLAN with VID == 1015 to IF -:ens5d1:-
Added VLAN with VID == 1016 to IF -:ens5d1:-
Added VLAN with VID == 1017 to IF -:ens5d1:-
Added VLAN with VID == 1018 to IF -:ens5d1:-
Added VLAN with VID == 1019 to IF -:ens5d1:-
Added VLAN with VID == 1020 to IF -:ens5d1:-
Added VLAN with VID == 1021 to IF -:ens5d1:-
Added VLAN with VID == 1022 to IF -:ens5d1:-
Added VLAN with VID == 1023 to IF -:ens5d1:-
Added VLAN with VID == 1024 to IF -:ens5d1:-
Added VLAN with VID == 1025 to IF -:ens5d1:-
Added VLAN with VID == 1026 to IF -:ens5d1:-
Added VLAN with VID == 1027 to IF -:ens5d1:-
Added VLAN with VID == 1028 to IF -:ens5d1:-
Added VLAN with VID == 1029 to IF -:ens5d1:-
Added VLAN with VID == 1030 to IF -:ens5d1:-
Added VLAN with VID == 1031 to IF -:ens5d1:-
Added VLAN with VID == 1032 to IF -:ens5d1:-
Added VLAN with VID == 1033 to IF -:ens5d1:-
Added VLAN with VID == 1034 to IF -:ens5d1:-
Added VLAN with VID == 1035 to IF -:ens5d1:-
Added VLAN with VID == 1036 to IF -:ens5d1:-
Added VLAN with VID == 1037 to IF -:ens5d1:-
Added VLAN with VID == 1038 to IF -:ens5d1:-
Added VLAN with VID == 1039 to IF -:ens5d1:-
Added VLAN with VID == 1040 to IF -:ens5d1:-
Added VLAN with VID == 1041 to IF -:ens5d1:-
Added VLAN with VID == 1042 to IF -:ens5d1:-
Added VLAN with VID == 1043 to IF -:ens5d1:-
Added VLAN with VID == 1044 to IF -:ens5d1:-
Added VLAN with VID == 1045 to IF -:ens5d1:-
Added VLAN with VID == 1046 to IF -:ens5d1:-
Added VLAN with VID == 1047 to IF -:ens5d1:-
Added VLAN with VID == 1048 to IF -:ens5d1:-

The resulting interface addresses:
$ ip addr
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eno1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether ec:b1:d7:3e:5f:f1 brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.118/24 brd 192.168.0.255 scope global noprefixroute eno1
       valid_lft forever preferred_lft forever
    inet6 fe80::ac79:9ebc:a4c0:a3c2/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
17: ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc mq state UP group default qlen 1000
    link/ether 00:02:c9:50:41:74 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::202:c9ff:fe50:4174/64 scope link 
       valid_lft forever preferred_lft forever
18: ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc mq state UP group default qlen 1000
    link/ether 00:02:c9:50:41:75 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::202:c9ff:fe50:4175/64 scope link 
       valid_lft forever preferred_lft forever
19: ens5.1001@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:01 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:1/64 scope link 
       valid_lft forever preferred_lft forever
20: ens5.1002@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:02 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:2/64 scope link 
       valid_lft forever preferred_lft forever
21: ens5.1003@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:03 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:3/64 scope link 
       valid_lft forever preferred_lft forever
22: ens5.1004@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:04 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:4/64 scope link 
       valid_lft forever preferred_lft forever
23: ens5.1005@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:05 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:5/64 scope link 
       valid_lft forever preferred_lft forever
24: ens5.1006@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:06 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:6/64 scope link 
       valid_lft forever preferred_lft forever
25: ens5.1007@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:07 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:7/64 scope link 
       valid_lft forever preferred_lft forever
26: ens5.1008@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:08 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:8/64 scope link 
       valid_lft forever preferred_lft forever
27: ens5.1009@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:09 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:9/64 scope link 
       valid_lft forever preferred_lft forever
28: ens5.1010@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:0a brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:a/64 scope link 
       valid_lft forever preferred_lft forever
29: ens5.1011@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:0b brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:b/64 scope link 
       valid_lft forever preferred_lft forever
30: ens5.1012@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:0c brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:c/64 scope link 
       valid_lft forever preferred_lft forever
31: ens5.1013@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:0d brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:d/64 scope link 
       valid_lft forever preferred_lft forever
32: ens5.1014@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:0e brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:e/64 scope link 
       valid_lft forever preferred_lft forever
33: ens5.1015@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:0f brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:f/64 scope link 
       valid_lft forever preferred_lft forever
34: ens5.1016@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:10 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:10/64 scope link 
       valid_lft forever preferred_lft forever
35: ens5.1017@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:11 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:11/64 scope link 
       valid_lft forever preferred_lft forever
36: ens5.1018@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:12 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:12/64 scope link 
       valid_lft forever preferred_lft forever
37: ens5.1019@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:13 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:13/64 scope link 
       valid_lft forever preferred_lft forever
38: ens5.1020@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:14 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:14/64 scope link 
       valid_lft forever preferred_lft forever
39: ens5.1021@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:15 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:15/64 scope link 
       valid_lft forever preferred_lft forever
40: ens5.1022@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:16 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:16/64 scope link 
       valid_lft forever preferred_lft forever
41: ens5.1023@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:17 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:17/64 scope link 
       valid_lft forever preferred_lft forever
42: ens5.1024@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:18 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:18/64 scope link 
       valid_lft forever preferred_lft forever
43: ens5.1025@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:19 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:19/64 scope link 
       valid_lft forever preferred_lft forever
44: ens5.1026@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:1a brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:1a/64 scope link 
       valid_lft forever preferred_lft forever
45: ens5.1027@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:1b brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:1b/64 scope link 
       valid_lft forever preferred_lft forever
46: ens5.1028@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:1c brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:1c/64 scope link 
       valid_lft forever preferred_lft forever
47: ens5.1029@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:1d brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:1d/64 scope link 
       valid_lft forever preferred_lft forever
48: ens5.1030@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:1e brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:1e/64 scope link 
       valid_lft forever preferred_lft forever
49: ens5.1031@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:1f brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:1f/64 scope link 
       valid_lft forever preferred_lft forever
50: ens5.1032@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:20 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:20/64 scope link 
       valid_lft forever preferred_lft forever
51: ens5.1033@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:21 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:21/64 scope link 
       valid_lft forever preferred_lft forever
52: ens5.1034@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:22 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:22/64 scope link 
       valid_lft forever preferred_lft forever
53: ens5.1035@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:23 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:23/64 scope link 
       valid_lft forever preferred_lft forever
54: ens5.1036@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:24 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:24/64 scope link 
       valid_lft forever preferred_lft forever
55: ens5.1037@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:25 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:25/64 scope link 
       valid_lft forever preferred_lft forever
56: ens5.1038@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:26 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:26/64 scope link 
       valid_lft forever preferred_lft forever
57: ens5.1039@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:27 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:27/64 scope link 
       valid_lft forever preferred_lft forever
58: ens5.1040@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:28 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:28/64 scope link 
       valid_lft forever preferred_lft forever
59: ens5.1041@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:29 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:29/64 scope link 
       valid_lft forever preferred_lft forever
60: ens5.1042@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:2a brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:2a/64 scope link 
       valid_lft forever preferred_lft forever
61: ens5.1043@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:2b brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:2b/64 scope link 
       valid_lft forever preferred_lft forever
62: ens5.1044@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:2c brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:2c/64 scope link 
       valid_lft forever preferred_lft forever
63: ens5.1045@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:2d brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:2d/64 scope link 
       valid_lft forever preferred_lft forever
64: ens5.1046@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:2e brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:2e/64 scope link 
       valid_lft forever preferred_lft forever
65: ens5.1047@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:2f brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:2f/64 scope link 
       valid_lft forever preferred_lft forever
66: ens5.1048@ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:01:00:00:30 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::1ff:fe00:30/64 scope link 
       valid_lft forever preferred_lft forever
67: ens5d1.1001@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:01 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:1/64 scope link 
       valid_lft forever preferred_lft forever
68: ens5d1.1002@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:02 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:2/64 scope link 
       valid_lft forever preferred_lft forever
69: ens5d1.1003@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:03 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:3/64 scope link 
       valid_lft forever preferred_lft forever
70: ens5d1.1004@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:04 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:4/64 scope link 
       valid_lft forever preferred_lft forever
71: ens5d1.1005@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:05 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:5/64 scope link 
       valid_lft forever preferred_lft forever
72: ens5d1.1006@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:06 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:6/64 scope link 
       valid_lft forever preferred_lft forever
73: ens5d1.1007@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:07 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:7/64 scope link 
       valid_lft forever preferred_lft forever
74: ens5d1.1008@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:08 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:8/64 scope link 
       valid_lft forever preferred_lft forever
75: ens5d1.1009@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:09 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:9/64 scope link 
       valid_lft forever preferred_lft forever
76: ens5d1.1010@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:0a brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:a/64 scope link 
       valid_lft forever preferred_lft forever
77: ens5d1.1011@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:0b brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:b/64 scope link 
       valid_lft forever preferred_lft forever
78: ens5d1.1012@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:0c brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:c/64 scope link 
       valid_lft forever preferred_lft forever
79: ens5d1.1013@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:0d brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:d/64 scope link 
       valid_lft forever preferred_lft forever
80: ens5d1.1014@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:0e brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:e/64 scope link 
       valid_lft forever preferred_lft forever
81: ens5d1.1015@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:0f brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:f/64 scope link 
       valid_lft forever preferred_lft forever
82: ens5d1.1016@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:10 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:10/64 scope link 
       valid_lft forever preferred_lft forever
83: ens5d1.1017@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:11 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:11/64 scope link 
       valid_lft forever preferred_lft forever
84: ens5d1.1018@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:12 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:12/64 scope link 
       valid_lft forever preferred_lft forever
85: ens5d1.1019@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:13 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:13/64 scope link 
       valid_lft forever preferred_lft forever
86: ens5d1.1020@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:14 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:14/64 scope link 
       valid_lft forever preferred_lft forever
87: ens5d1.1021@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:15 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:15/64 scope link 
       valid_lft forever preferred_lft forever
88: ens5d1.1022@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:16 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:16/64 scope link 
       valid_lft forever preferred_lft forever
89: ens5d1.1023@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:17 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:17/64 scope link 
       valid_lft forever preferred_lft forever
90: ens5d1.1024@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:18 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:18/64 scope link 
       valid_lft forever preferred_lft forever
91: ens5d1.1025@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:19 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:19/64 scope link 
       valid_lft forever preferred_lft forever
92: ens5d1.1026@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:1a brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:1a/64 scope link 
       valid_lft forever preferred_lft forever
93: ens5d1.1027@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:1b brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:1b/64 scope link 
       valid_lft forever preferred_lft forever
94: ens5d1.1028@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:1c brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:1c/64 scope link 
       valid_lft forever preferred_lft forever
95: ens5d1.1029@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:1d brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:1d/64 scope link 
       valid_lft forever preferred_lft forever
96: ens5d1.1030@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:1e brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:1e/64 scope link 
       valid_lft forever preferred_lft forever
97: ens5d1.1031@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:1f brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:1f/64 scope link 
       valid_lft forever preferred_lft forever
98: ens5d1.1032@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:20 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:20/64 scope link 
       valid_lft forever preferred_lft forever
99: ens5d1.1033@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:21 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:21/64 scope link 
       valid_lft forever preferred_lft forever
100: ens5d1.1034@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:22 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:22/64 scope link 
       valid_lft forever preferred_lft forever
101: ens5d1.1035@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:23 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:23/64 scope link 
       valid_lft forever preferred_lft forever
102: ens5d1.1036@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:24 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:24/64 scope link 
       valid_lft forever preferred_lft forever
103: ens5d1.1037@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:25 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:25/64 scope link 
       valid_lft forever preferred_lft forever
104: ens5d1.1038@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:26 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:26/64 scope link 
       valid_lft forever preferred_lft forever
105: ens5d1.1039@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:27 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:27/64 scope link 
       valid_lft forever preferred_lft forever
106: ens5d1.1040@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:28 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:28/64 scope link 
       valid_lft forever preferred_lft forever
107: ens5d1.1041@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:29 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:29/64 scope link 
       valid_lft forever preferred_lft forever
108: ens5d1.1042@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:2a brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:2a/64 scope link 
       valid_lft forever preferred_lft forever
109: ens5d1.1043@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:2b brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:2b/64 scope link 
       valid_lft forever preferred_lft forever
110: ens5d1.1044@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:2c brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:2c/64 scope link 
       valid_lft forever preferred_lft forever
111: ens5d1.1045@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:2d brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:2d/64 scope link 
       valid_lft forever preferred_lft forever
112: ens5d1.1046@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:2e brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:2e/64 scope link 
       valid_lft forever preferred_lft forever
113: ens5d1.1047@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:2f brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:2f/64 scope link 
       valid_lft forever preferred_lft forever
114: ens5d1.1048@ens5d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9216 qdisc noqueue state UP group default qlen 1000
    link/ether 02:00:02:00:00:30 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::2ff:fe00:30/64 scope link 
       valid_lft forever preferred_lft forever
mr_halfword@Haswell-Ubuntu:~/ibv_message_passing$ 

And the GIDs:
$ ~/mlnx-tools/ofed_scripts/show_gids 
DEV PORT    INDEX   GID                 IPv4        VER DEV
--- ----    -----   ---                 ------------    --- ---
mlx4_0  1   0   fe80:0000:0000:0000:0202:c9ff:fe50:4174         v1  ens5
mlx4_0  1   1   fe80:0000:0000:0000:0000:01ff:fe00:0001         v1  ens5.1001
mlx4_0  1   10  fe80:0000:0000:0000:0000:01ff:fe00:000a         v1  ens5.1010
mlx4_0  1   11  fe80:0000:0000:0000:0000:01ff:fe00:000b         v1  ens5.1011
mlx4_0  1   12  fe80:0000:0000:0000:0000:01ff:fe00:000c         v1  ens5.1012
mlx4_0  1   13  fe80:0000:0000:0000:0000:01ff:fe00:000d         v1  ens5.1013
mlx4_0  1   14  fe80:0000:0000:0000:0000:01ff:fe00:000e         v1  ens5.1014
mlx4_0  1   15  fe80:0000:0000:0000:0000:01ff:fe00:000f         v1  ens5.1015
mlx4_0  1   16  fe80:0000:0000:0000:0000:01ff:fe00:0010         v1  ens5.1016
mlx4_0  1   17  fe80:0000:0000:0000:0000:01ff:fe00:0011         v1  ens5.1017
mlx4_0  1   18  fe80:0000:0000:0000:0000:01ff:fe00:0012         v1  ens5.1018
mlx4_0  1   19  fe80:0000:0000:0000:0000:01ff:fe00:0013         v1  ens5.1019
mlx4_0  1   2   fe80:0000:0000:0000:0000:01ff:fe00:0002         v1  ens5.1002
mlx4_0  1   20  fe80:0000:0000:0000:0000:01ff:fe00:0014         v1  ens5.1020
mlx4_0  1   21  fe80:0000:0000:0000:0000:01ff:fe00:0015         v1  ens5.1021
mlx4_0  1   22  fe80:0000:0000:0000:0000:01ff:fe00:0016         v1  ens5.1022
mlx4_0  1   23  fe80:0000:0000:0000:0000:01ff:fe00:0017         v1  ens5.1023
mlx4_0  1   24  fe80:0000:0000:0000:0000:01ff:fe00:0018         v1  ens5.1024
mlx4_0  1   25  fe80:0000:0000:0000:0000:01ff:fe00:0019         v1  ens5.1025
mlx4_0  1   26  fe80:0000:0000:0000:0000:01ff:fe00:001a         v1  ens5.1026
mlx4_0  1   27  fe80:0000:0000:0000:0000:01ff:fe00:001b         v1  ens5.1027
mlx4_0  1   28  fe80:0000:0000:0000:0000:01ff:fe00:001c         v1  ens5.1028
mlx4_0  1   29  fe80:0000:0000:0000:0000:01ff:fe00:001d         v1  ens5.1029
mlx4_0  1   3   fe80:0000:0000:0000:0000:01ff:fe00:0003         v1  ens5.1003
mlx4_0  1   30  fe80:0000:0000:0000:0000:01ff:fe00:001e         v1  ens5.1030
mlx4_0  1   31  fe80:0000:0000:0000:0000:01ff:fe00:001f         v1  ens5.1031
mlx4_0  1   32  fe80:0000:0000:0000:0000:01ff:fe00:0020         v1  ens5.1032
mlx4_0  1   33  fe80:0000:0000:0000:0000:01ff:fe00:0021         v1  ens5.1033
mlx4_0  1   34  fe80:0000:0000:0000:0000:01ff:fe00:0022         v1  ens5.1034
mlx4_0  1   35  fe80:0000:0000:0000:0000:01ff:fe00:0023         v1  ens5.1035
mlx4_0  1   36  fe80:0000:0000:0000:0000:01ff:fe00:0024         v1  ens5.1036
mlx4_0  1   37  fe80:0000:0000:0000:0000:01ff:fe00:0025         v1  ens5.1037
mlx4_0  1   38  fe80:0000:0000:0000:0000:01ff:fe00:0026         v1  ens5.1038
mlx4_0  1   39  fe80:0000:0000:0000:0000:01ff:fe00:0027         v1  ens5.1039
mlx4_0  1   4   fe80:0000:0000:0000:0000:01ff:fe00:0004         v1  ens5.1004
mlx4_0  1   40  fe80:0000:0000:0000:0000:01ff:fe00:0028         v1  ens5.1040
mlx4_0  1   41  fe80:0000:0000:0000:0000:01ff:fe00:0029         v1  ens5.1041
mlx4_0  1   42  fe80:0000:0000:0000:0000:01ff:fe00:002a         v1  ens5.1042
mlx4_0  1   43  fe80:0000:0000:0000:0000:01ff:fe00:002b         v1  ens5.1043
mlx4_0  1   44  fe80:0000:0000:0000:0000:01ff:fe00:002c         v1  ens5.1044
mlx4_0  1   45  fe80:0000:0000:0000:0000:01ff:fe00:002d         v1  ens5.1045
mlx4_0  1   46  fe80:0000:0000:0000:0000:01ff:fe00:002e         v1  ens5.1046
mlx4_0  1   47  fe80:0000:0000:0000:0000:01ff:fe00:002f         v1  ens5.1047
mlx4_0  1   48  fe80:0000:0000:0000:0000:01ff:fe00:0030         v1  ens5.1048
mlx4_0  1   5   fe80:0000:0000:0000:0000:01ff:fe00:0005         v1  ens5.1005
mlx4_0  1   6   fe80:0000:0000:0000:0000:01ff:fe00:0006         v1  ens5.1006
mlx4_0  1   7   fe80:0000:0000:0000:0000:01ff:fe00:0007         v1  ens5.1007
mlx4_0  1   8   fe80:0000:0000:0000:0000:01ff:fe00:0008         v1  ens5.1008
mlx4_0  1   9   fe80:0000:0000:0000:0000:01ff:fe00:0009         v1  ens5.1009
mlx4_0  2   0   fe80:0000:0000:0000:0202:c9ff:fe50:4175         v1  ens5d1
mlx4_0  2   1   fe80:0000:0000:0000:0000:02ff:fe00:0001         v1  ens5d1.1001
mlx4_0  2   10  fe80:0000:0000:0000:0000:02ff:fe00:000a         v1  ens5d1.1010
mlx4_0  2   11  fe80:0000:0000:0000:0000:02ff:fe00:000b         v1  ens5d1.1011
mlx4_0  2   12  fe80:0000:0000:0000:0000:02ff:fe00:000c         v1  ens5d1.1012
mlx4_0  2   13  fe80:0000:0000:0000:0000:02ff:fe00:000d         v1  ens5d1.1013
mlx4_0  2   14  fe80:0000:0000:0000:0000:02ff:fe00:000e         v1  ens5d1.1014
mlx4_0  2   15  fe80:0000:0000:0000:0000:02ff:fe00:000f         v1  ens5d1.1015
mlx4_0  2   16  fe80:0000:0000:0000:0000:02ff:fe00:0010         v1  ens5d1.1016
mlx4_0  2   17  fe80:0000:0000:0000:0000:02ff:fe00:0011         v1  ens5d1.1017
mlx4_0  2   18  fe80:0000:0000:0000:0000:02ff:fe00:0012         v1  ens5d1.1018
mlx4_0  2   19  fe80:0000:0000:0000:0000:02ff:fe00:0013         v1  ens5d1.1019
mlx4_0  2   2   fe80:0000:0000:0000:0000:02ff:fe00:0002         v1  ens5d1.1002
mlx4_0  2   20  fe80:0000:0000:0000:0000:02ff:fe00:0014         v1  ens5d1.1020
mlx4_0  2   21  fe80:0000:0000:0000:0000:02ff:fe00:0015         v1  ens5d1.1021
mlx4_0  2   22  fe80:0000:0000:0000:0000:02ff:fe00:0016         v1  ens5d1.1022
mlx4_0  2   23  fe80:0000:0000:0000:0000:02ff:fe00:0017         v1  ens5d1.1023
mlx4_0  2   24  fe80:0000:0000:0000:0000:02ff:fe00:0018         v1  ens5d1.1024
mlx4_0  2   25  fe80:0000:0000:0000:0000:02ff:fe00:0019         v1  ens5d1.1025
mlx4_0  2   26  fe80:0000:0000:0000:0000:02ff:fe00:001a         v1  ens5d1.1026
mlx4_0  2   27  fe80:0000:0000:0000:0000:02ff:fe00:001b         v1  ens5d1.1027
mlx4_0  2   28  fe80:0000:0000:0000:0000:02ff:fe00:001c         v1  ens5d1.1028
mlx4_0  2   29  fe80:0000:0000:0000:0000:02ff:fe00:001d         v1  ens5d1.1029
mlx4_0  2   3   fe80:0000:0000:0000:0000:02ff:fe00:0003         v1  ens5d1.1003
mlx4_0  2   30  fe80:0000:0000:0000:0000:02ff:fe00:001e         v1  ens5d1.1030
mlx4_0  2   31  fe80:0000:0000:0000:0000:02ff:fe00:001f         v1  ens5d1.1031
mlx4_0  2   32  fe80:0000:0000:0000:0000:02ff:fe00:0020         v1  ens5d1.1032
mlx4_0  2   33  fe80:0000:0000:0000:0000:02ff:fe00:0021         v1  ens5d1.1033
mlx4_0  2   34  fe80:0000:0000:0000:0000:02ff:fe00:0022         v1  ens5d1.1034
mlx4_0  2   35  fe80:0000:0000:0000:0000:02ff:fe00:0023         v1  ens5d1.1035
mlx4_0  2   36  fe80:0000:0000:0000:0000:02ff:fe00:0024         v1  ens5d1.1036
mlx4_0  2   37  fe80:0000:0000:0000:0000:02ff:fe00:0025         v1  ens5d1.1037
mlx4_0  2   38  fe80:0000:0000:0000:0000:02ff:fe00:0026         v1  ens5d1.1038
mlx4_0  2   39  fe80:0000:0000:0000:0000:02ff:fe00:0027         v1  ens5d1.1039
mlx4_0  2   4   fe80:0000:0000:0000:0000:02ff:fe00:0004         v1  ens5d1.1004
mlx4_0  2   40  fe80:0000:0000:0000:0000:02ff:fe00:0028         v1  ens5d1.1040
mlx4_0  2   41  fe80:0000:0000:0000:0000:02ff:fe00:0029         v1  ens5d1.1041
mlx4_0  2   42  fe80:0000:0000:0000:0000:02ff:fe00:002a         v1  ens5d1.1042
mlx4_0  2   43  fe80:0000:0000:0000:0000:02ff:fe00:002b         v1  ens5d1.1043
mlx4_0  2   44  fe80:0000:0000:0000:0000:02ff:fe00:002c         v1  ens5d1.1044
mlx4_0  2   45  fe80:0000:0000:0000:0000:02ff:fe00:002d         v1  ens5d1.1045
mlx4_0  2   46  fe80:0000:0000:0000:0000:02ff:fe00:002e         v1  ens5d1.1046
mlx4_0  2   47  fe80:0000:0000:0000:0000:02ff:fe00:002f         v1  ens5d1.1047
mlx4_0  2   48  fe80:0000:0000:0000:0000:02ff:fe00:0030         v1  ens5d1.1048
mlx4_0  2   5   fe80:0000:0000:0000:0000:02ff:fe00:0005         v1  ens5d1.1005
mlx4_0  2   6   fe80:0000:0000:0000:0000:02ff:fe00:0006         v1  ens5d1.1006
mlx4_0  2   7   fe80:0000:0000:0000:0000:02ff:fe00:0007         v1  ens5d1.1007
mlx4_0  2   8   fe80:0000:0000:0000:0000:02ff:fe00:0008         v1  ens5d1.1008
mlx4_0  2   9   fe80:0000:0000:0000:0000:02ff:fe00:0009         v1  ens5d1.1009
n_gids_found=98

A test using IBV_QPT_RC is successful, in that can transmit and receive on different VLANs (with the loopback between 
injection switch ports 25 and 26 changing the transmit to receive VLAN):
$ ibv_rc_pingpong -d mlx4_0 -i 1 -g 25
  local address:  LID 0x0000, QPN 0x00023c, PSN 0xc78b8d, GID fe80::1ff:fe00:19
  remote address: LID 0x0000, QPN 0x00023d, PSN 0x7138c2, GID fe80::2ff:fe00:1a
8192000 bytes in 0.02 seconds = 2983.79 Mbit/sec
1000 iters in 0.02 seconds = 21.96 usec/iter

$ ibv_rc_pingpong -d mlx4_0 -i 2 -g 26 localhost 
  local address:  LID 0x0000, QPN 0x00023d, PSN 0x7138c2, GID fe80::2ff:fe00:1a
  remote address: LID 0x0000, QPN 0x00023c, PSN 0xc78b8d, GID fe80::1ff:fe00:19
8192000 bytes in 0.02 seconds = 3004.58 Mbit/sec
1000 iters in 0.02 seconds = 21.81 usec/iter
mr_halfword@Haswell-Ubuntu:~/ibv_message_passing$ 

Using a mirror port in the injection switch and Wireshark shows the expected VLAN and source / destination MAC addresses used.


A test using IBV_QPT_UC is successful, in that can transmit and receive on different VLANs (with the loopback between 
injection switch ports 25 and 26 changing the transmit to receive VLAN):
$ ibv_uc_pingpong -d mlx4_0 -i 1 -g 25
  local address:  LID 0x0000, QPN 0x00023e, PSN 0xb4b4e1, GID fe80::1ff:fe00:19

  remote address: LID 0x0000, QPN 0x00023f, PSN 0x2f989d, GID fe80::2ff:fe00:1a
8192000 bytes in 0.02 seconds = 2999.22 Mbit/sec
1000 iters in 0.02 seconds = 21.85 usec/iter

$ ibv_uc_pingpong -d mlx4_0 -i 2 -g 26 localhost 
  local address:  LID 0x0000, QPN 0x00023f, PSN 0x2f989d, GID fe80::2ff:fe00:1a
  remote address: LID 0x0000, QPN 0x00023e, PSN 0xb4b4e1, GID fe80::1ff:fe00:19
8192000 bytes in 0.02 seconds = 3018.70 Mbit/sec
1000 iters in 0.02 seconds = 21.71 usec/iter


A test using IBV_QPT_UD fails. The test doesn't complete, and has to be killed:
$ ibv_ud_pingpong -d mlx4_0 -i 1 -g 25
  local address:  LID 0x0000, QPN 0x000240, PSN 0x1475ba: GID fe80::1ff:fe00:19
  remote address: LID 0x0000, QPN 0x000241, PSN 0x71fd44, GID fe80::2ff:fe00:1a
^C

$ ibv_ud_pingpong -d mlx4_0 -i 2 -g 26 localhost 
  local address:  LID 0x0000, QPN 0x000241, PSN 0x71fd44: GID fe80::2ff:fe00:1a
  remote address: LID 0x0000, QPN 0x000240, PSN 0x1475ba, GID fe80::1ff:fe00:19
^C

Using a mirror port in the injection switch and Wireshark shows only a single frame was transmitted:
No.     Time           Source                Destination           Protocol Length Info
   3481 1013.413088447 GID: fe80::2ff:fe00:1a GID: fe80::1ff:fe00:19 InfiniBand 2126   UD Send Only 

Frame 3481: 2126 bytes on wire (17008 bits), 2126 bytes captured (17008 bits) on interface 0
Ethernet II, Src: Mellanox_50:41:75 (00:02:c9:50:41:75), Dst: 02:00:01:00:00:19 (02:00:01:00:00:19)
InfiniBand
    Global Route Header
        0110 .... = IP Version: 6
        .... 0000 0000 .... = Traffic Class: 0
        .... .... .... 0000 0000 0000 0000 0000 = Flow Label: 0
        Payload Length: 2072
        Next Header: 27
        Hop Limit: 1
        Source GID: fe80::2ff:fe00:1a (fe80::2ff:fe00:1a)
        Destination GID: fe80::1ff:fe00:19 (fe80::1ff:fe00:19)
    Base Transport Header
    DETH - Datagram Extended Transport Header
    Invariant CRC: 0x7b7b7937
    Variant CRC: 0x8800

The issue is that the source MAC address is from GID zero and there is no VLAN (GID zero has no VLAN).
Debugging into the ibv_post_send() call can see the source GID is set in the UD segment written to
the mlx4_wqe_datagram_seg av.gid_index field written to the device, but the gid_index seems to be ignored
by the device and GID index zero is used instead.

Where the structure is defined in https://github.com/linux-rdma/rdma-core/blob/master/providers/mlx4/mlx4dv.h

Other fields in the same structure, e.g. mac[] which gives the destination MAC address are used by the
device to form the Ethernet frame sent. 

Not sure if the source GID being ignored in the address header passed to the ibv_post_send() call for IBV_QPT_UD
is a bug or a limitation of the ConnectX-2 VPI device.

With IBV_QPT_RC or IBV_QPT_UC the source GID is set when the Queue-Pair is transitioned to Ready-To-Receive.

Whereas with a IBV_QPT_UD the source GID can only be specified duringf the send.


== Injection switch config ==

The following is the configuration used for the full set of VLANs 1001 .. 1026 for using ports 1..26 on the injection
switch to run the switch_test program, with PCAP, on the ConnectX2.

T1700G-28TQ#show running-config 
!T1700G-28TQRev3


#
 vlan 1001
 name "port 1"
 #
 vlan 1002
 name "port 2"
 #
 vlan 1003
 name "port 3"
 #
 vlan 1004
 name "port 4"
 #
 vlan 1005
 name "port 5"
 #
 vlan 1006
 name "port 6"
 #
 vlan 1007
 name "port 7"
 #                                    
 vlan 1008                            
 name "port 8"                        
 #                                    
 vlan 1009
 name "port 9"
 #
 vlan 1010
 name "port 10"
 #
 vlan 1011
 name "port 11"
 #
 vlan 1012
 name "port 12"
 #
 vlan 1013
 name "port 13"
 #
 vlan 1014
 name "port 14"
 #
 vlan 1015
 name "port 15"
 #
 vlan 1016
 name "port 16"
 #                                    
 vlan 1017
 name "port 17"
 #
 vlan 1018
 name "port 18"
 #
 vlan 1019
 name "port 19"
 #
 vlan 1020
 name "port 20"
 #
 vlan 1021
 name "port 21"
 #
 vlan 1022
 name "port 22"
 #
 vlan 1023
 name "port 23"
 #
 vlan 1024
 name "port 24"
 #                                    
 vlan 1025
 name "port 25"
 #
 vlan 1026
 name "port 26"
 #
#
 switch 1 provision T1700G-28TQRev3
 jumbo-size 9216
 user name admin privilege admin secret 5 $1$B0B2B>B8G9E6J4J6D2H8D9@=D9H/A>L2$'}./
 telnet disable
 ip ssh server
 system-time ntp UTC+08:00 133.100.9.2 139.78.100.163 12
 #
 #
#
interface vlan 1
 ip address 192.168.0.91 255.255.255.0
 ipv6 enable
#
interface gigabitEthernet 1/0/1
 switchport general allowed vlan 1001 untagged
 no switchport general allowed vlan 1
 switchport pvid 1001                 
 
#
interface gigabitEthernet 1/0/2
 switchport general allowed vlan 1002 untagged
 no switchport general allowed vlan 1
 switchport pvid 1002
 
#
interface gigabitEthernet 1/0/3
 switchport general allowed vlan 1003 untagged
 no switchport general allowed vlan 1
 switchport pvid 1003
 
#
interface gigabitEthernet 1/0/4
 switchport general allowed vlan 1004 untagged
 no switchport general allowed vlan 1
 switchport pvid 1004
 
#
interface gigabitEthernet 1/0/5
 switchport general allowed vlan 1005 untagged
 no switchport general allowed vlan 1
 switchport pvid 1005                 
 
#
interface gigabitEthernet 1/0/6
 switchport general allowed vlan 1006 untagged
 no switchport general allowed vlan 1
 switchport pvid 1006
 
#
interface gigabitEthernet 1/0/7
 switchport general allowed vlan 1007 untagged
 no switchport general allowed vlan 1
 switchport pvid 1007
 
#
interface gigabitEthernet 1/0/8
 switchport general allowed vlan 1008 untagged
 no switchport general allowed vlan 1
 switchport pvid 1008
 
#
interface gigabitEthernet 1/0/9
 switchport general allowed vlan 1009 untagged
 no switchport general allowed vlan 1
 switchport pvid 1009                 
 
#
interface gigabitEthernet 1/0/10
 switchport general allowed vlan 1010 untagged
 no switchport general allowed vlan 1
 switchport pvid 1010
 
#
interface gigabitEthernet 1/0/11
 switchport general allowed vlan 1011 untagged
 no switchport general allowed vlan 1
 switchport pvid 1011
 
#
interface gigabitEthernet 1/0/12
 switchport general allowed vlan 1012 untagged
 no switchport general allowed vlan 1
 switchport pvid 1012
 
#
interface gigabitEthernet 1/0/13
 switchport general allowed vlan 1013 untagged
 no switchport general allowed vlan 1
 switchport pvid 1013                 
 
#
interface gigabitEthernet 1/0/14
 switchport general allowed vlan 1014 untagged
 no switchport general allowed vlan 1
 switchport pvid 1014
 
#
interface gigabitEthernet 1/0/15
 switchport general allowed vlan 1015 untagged
 no switchport general allowed vlan 1
 switchport pvid 1015
 
#
interface gigabitEthernet 1/0/16
 switchport general allowed vlan 1016 untagged
 no switchport general allowed vlan 1
 switchport pvid 1016
 
#
interface gigabitEthernet 1/0/17
 switchport general allowed vlan 1017 untagged
 no switchport general allowed vlan 1
 switchport pvid 1017                 
 
#
interface gigabitEthernet 1/0/18
 switchport general allowed vlan 1018 untagged
 no switchport general allowed vlan 1
 switchport pvid 1018
 
#
interface gigabitEthernet 1/0/19
 switchport general allowed vlan 1019 untagged
 no switchport general allowed vlan 1
 switchport pvid 1019
 
#
interface gigabitEthernet 1/0/20
 switchport general allowed vlan 1020 untagged
 no switchport general allowed vlan 1
 switchport pvid 1020
 
#
interface gigabitEthernet 1/0/21
 switchport general allowed vlan 1021 untagged
 no switchport general allowed vlan 1
 switchport pvid 1021                 
 
#
interface gigabitEthernet 1/0/22
 switchport general allowed vlan 1022 untagged
 no switchport general allowed vlan 1
 switchport pvid 1022
 
#
interface gigabitEthernet 1/0/23
 switchport general allowed vlan 1023 untagged
 no switchport general allowed vlan 1
 switchport pvid 1023
 
#
interface gigabitEthernet 1/0/24
 switchport general allowed vlan 1024 untagged
 no switchport general allowed vlan 1
 switchport pvid 1024
 
#
interface ten-gigabitEthernet 1/0/25
 switchport general allowed vlan 1025 untagged
 no switchport general allowed vlan 1
 switchport pvid 1025                 
 
#
interface ten-gigabitEthernet 1/0/26
 switchport general allowed vlan 1026 untagged
 no switchport general allowed vlan 1
 switchport pvid 1026
 
#
interface ten-gigabitEthernet 1/0/27
 switchport general allowed vlan 1001-1026 tagged
 
#
interface ten-gigabitEthernet 1/0/28
 switchport general allowed vlan 1001-1026 tagged
 
#
#


== Switch test to find maximum packet rate using the two 10G ports 25 and 26 ==

The switch_test was run on just the ports 25 and 26 connected via a 10G DAC loopback cable, and no rate limit applied.

The test didn't report any errors:
mr_halfword@Haswell-Ubuntu:~/switch_test/Release$ ./switch_test -i ens5 -p 25,26 -r -1
Writing per-port counts to 20220103T192801_per_port_counts_linux.csv
Using interface ens5 (No description available)
Test interval = 10 (secs)
Frame debug enabled = No
Frame transmit max rate = None
Press Ctrl-C to stop test at end of next test interval

19:28:11.521
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      3186687              0        3186683              0              0              1              0       318668.7

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port  22
        56
    25   .
    26  . 
Total test intervals with failures = 0

19:28:21.521
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      3243583              0        3243584              0              0              0              0       324358.2

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port  22
        56
    25   .
    26  . 
Total test intervals with failures = 0

19:28:31.520
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      3249089              0        3249089              0              0              0              0       324909.0

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port  22
        56
    25   .
    26  . 
Total test intervals with failures = 0

19:28:41.521
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      3247038              0        3247037              0              0              0              0       324703.8

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port  22
        56
    25   .
    26  . 
Total test intervals with failures = 0

19:28:51.520
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      3247704              0        3247705              0              0              0              0       324770.4

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port  22
        56
    25   .
    26  . 
Total test intervals with failures = 0

19:29:01.520
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      3241211              0        3241209              0              0              0              0       324121.1

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port  22
        56
    25   .
    26  . 
Total test intervals with failures = 0

19:29:11.521
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      3257054              0        3257055              0              0              4              0       325705.4

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port  22
        56
    25   .
    26  . 
Total test intervals with failures = 0

19:29:21.520
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      3245875              0        3245874              0              0              0              0       324587.5

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port  22
        56
    25   .
    26  . 
Total test intervals with failures = 0
^C
19:29:31.520
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      3246691              0        3246692              0              0              0              0       324669.2

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port  22
        56
    25   .
    26  . 
Total test intervals with failures = 0
Max pending rx frames = 96 out of 1656

The transmit frame rate of 325000 per second equates to 4,009,200,000 bits per second, 83,525,000 if shared across
48 ports. So, maximum usage on 48 100M ports would be ~83.5%

The contents of /proc/interrupts was compared before and after this 90 second test. Of the 24 mlx4 interrupts, the
large changes during the test were:
- 27,387,212 delivered to CPU5 for interrupt mlx4-1@0000:03:00.0
-  1,305,063 delivered to CPU8 for interrupt mlx4-3@0000:03:00.0

The total number of frames sent and received during the test was ~29,250,000 and 28,692,275 Ethernet device interrupts
were delivered during the test.


== switch_test error due to setting the wrong PVIDs in the injection switch ==

[due to a mistake the requested frame rate was specified as 144552, rather than 194552 which in thoery generates
 100% utilisatrion on 24 100M ports]

On the first attempt to run a test using the 24 ports on the tp-Link TL-SF1024 under test got all frames reported as
missing for the *destination* ports 11 and 15: 
$ ./switch_test -i ens5 -p 1-24 -r 144552
Writing per-port counts to 20220103T194904_per_port_counts_linux.csv
Using interface ens5 (No description available)
Test interval = 10 (secs)
Frame debug enabled = No
Frame transmit max rate = 144552 Hz
Press Ctrl-C to stop test at end of next test interval

19:49:14.525
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1445714              0        1325202              0             20              4         120200       144571.4

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .........A...A.........
     2  . ........A...A.........
     3  .. .......A...A.........
     4  ... ......A...A.........
     5  .... .....A...A.........
     6  ..... ....A...A.........
     7  ...... ...A...A.........
     8  ....... ..A...A.........
     9  ........ .A...A.........
    10  ......... A...A.........
    11  .......... ...A.........
    12  ..........A ..A.........
    13  ..........A. .A.........
    14  ..........A.. A.........
    15  ..........A... .........
    16  ..........A...A ........
    17  ..........A...A. .......
    18  ..........A...A.. ......
    19  ..........A...A... .....
    20  ..........A...A.... ....
    21  ..........A...A..... ...
    22  ..........A...A...... ..
    23  ..........A...A....... .
    24  ..........A...A........ 
PCAP statistics : ps_recv=1325237 ps_drop=0 ps_ifdrop=1325232
Total test intervals with failures = 1 : last failure NOW

Looking back at the injection switch VLAN configuration had incorrectly set

#
interface gigabitEthernet 1/0/11
 switchport general allowed vlan 1011 untagged
 no switchport general allowed vlan 1
 switchport pvid 1018   <--- should be 1011

#
interface gigabitEthernet 1/0/15
 switchport general allowed vlan 1015 untagged
 no switchport general allowed vlan 1
 switchport pvid 1023   <--- should be 1015

While the switch_test was left running corrected the PVID's for ports 11 and 15 in the injection switch, and the
switch_test program then reported no errors.


== Test to get in theory 100% utilitisation on all 24 100M ports in the switch under test ==

For this ran the test specifying the 24 100M ports on the switch under test, with the frame rate set manually to
try and get 100% utilisation.

In 2 out of the 21 test iterations were were some missed frames reported, which could be a side effect of trying to get
100% utilisation on all 100M ports in the switch under test. I.e. to get a reliable test may have to drop the frame rate
a bit.
 
$ ./switch_test -i ens5 -p 1-24 -r 194552
Writing per-port counts to 20220103T205550_per_port_counts_linux.csv
Using interface ens5 (No description available)
Test interval = 10 (secs)
Frame debug enabled = No
Frame transmit max rate = 194552 Hz
Press Ctrl-C to stop test at end of next test interval

20:56:00.733
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945525              0        1945432              0              0              0             32       194552.5

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .............S....S....
     2  . .............S....S...
     3  .. ............S........
     4  ... ............S....S..
     5  .... ............S....S.
     6  ..... ............S....S
     7  ...... ............S...S
     8  ....... ................
     9  S....... ...............
    10  .S....... ...........S..
    11  ..S....... ...........S.
    12  ........... ...........S
    13  ...S........ ...........
    14  S...S........ ..........
    15  S....S........ .........
    16  ......S........ ........
    17  .......S........ .......
    18  ................. ......
    19  .................. .....
    20  .........S......... ....
    21  ..........S......... ...
    22  ...........S......... ..
    23  ............S......... .
    24  .............S....S.... 
PCAP statistics : ps_recv=1945432 ps_drop=0 ps_ifdrop=1945432
Total test intervals with failures = 1 : last failure NOW

20:56:10.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945525              0        1945517              0              0              0              0       194552.5

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 1 : last failure 20:56:00.733

20:56:20.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945526              0        1945531              0              0              1              0       194552.6

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 1 : last failure 20:56:00.733

20:56:30.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945525              0        1945515              0              0              0              0       194552.5

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 1 : last failure 20:56:00.733

20:56:40.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945526              0        1945533              0              0              0              0       194552.6

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 1 : last failure 20:56:00.733

20:56:50.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945523              0        1945532              0              0              0              0       194552.3

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 1 : last failure 20:56:00.733

20:57:00.733
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945528              0        1944746              0              0              0            770       194552.8

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   ..SSSS..SSSSSS.SSSSSSSS
     2  S .SSSSS..SSSSSSS.S..SSS
     3  SS .SSSSS..SSSSS.S.SSS.S
     4  SSS .S.SS..SSSSSSSS.SSSS
     5  S.S. SSSSS..SSSS..SSSSSS
     6  SS.S. SSSSS..SSSSS..SSSS
     7  SSSSSS SSSSS.SSSSSSSS.SS
     8  SSSSSS. SSSS.SSSS.S.SSSS
     9  SSSSSSSS S.SS..SSSS..SSS
    10  SSSSSSSSS S.SS..SSSS..SS
    11  SSSSSSSS.. .SSS..SS.S..S
    12  SSSS.SSSSS. .SS..SSS.S.S
    13  SSSSS.SSSSSS .SS..SSSS..
    14  SSSSSS.SSS..S SSS..SSSS.
    15  .SSSS..SSSSSSS SS...S.SS
    16  .SSSSSS.S.SSSS. SS..SSSS
    17  SSSSSSSS.S.SSSS. .S..SSS
    18  S.SSSSSSS.S.SS.S. SS..S.
    19  SSS.SSSS.S.SSSS.SS SS..S
    20  SSS..SSSSS..SSSS.SS S..S
    21  SSSS..SSSSS.SSSS.SSS S..
    22  SSSSS..SSSSS.SSS..SSS S.
    23  .S.SS..SSSSSS.SSSS.SSS S
    24  .SSSSS..S.SSSS.SSSS.S.S 
PCAP statistics : ps_recv=13617844 ps_drop=0 ps_ifdrop=13617830
Total test intervals with failures = 2 : last failure NOW

20:57:10.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945520              0        1945536              0              0              3              0       194552.0

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 2 : last failure 20:57:00.733

20:57:20.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945530              0        1945496              0              0              1              0       194553.0

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 2 : last failure 20:57:00.733

20:57:30.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945524              0        1945552              0              0              0              0       194552.4

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 2 : last failure 20:57:00.733

20:57:40.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945525              0        1945512              0              0              0              0       194552.5

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 2 : last failure 20:57:00.733

20:57:50.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945527              0        1945536              0              0              0              0       194552.7

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 2 : last failure 20:57:00.733

20:58:00.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945526              0        1945512              0              0              0              0       194552.6

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 2 : last failure 20:57:00.733

20:58:10.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945525              0        1945296              0              0              0              0       194552.5

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 2 : last failure 20:57:00.733

20:58:20.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945525              0        1945752              0              0              0              0       194552.5

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 2 : last failure 20:57:00.733

20:58:30.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945525              0        1945536              0              0              0              0       194552.5

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 2 : last failure 20:57:00.733

20:58:40.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945523              0        1945536              0              0              0              0       194552.3

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 2 : last failure 20:57:00.733

20:58:50.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945528              0        1945512              0              0              0              0       194552.8

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 2 : last failure 20:57:00.733

20:59:00.733
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945525              0        1945392              0              0              0              0       194552.5

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 2 : last failure 20:57:00.733

20:59:10.732
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945525              0        1945657              0              0              3              0       194552.5

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 2 : last failure 20:57:00.733
^C
20:59:20.733
      Tx Test        Tx Copy        Rx Test  Rx Unexpected     Rx Flooded       Rx Other  missed frames   tx rate (Hz)
      1945526              0        1945535              0              0              1              0       194552.6

Summary of missed frames : '.' none missed 'S' some missed 'A' all missed
Source  Destination ports --->
  port           111111111122222
        123456789012345678901234
     1   .......................
     2  . ......................
     3  .. .....................
     4  ... ....................
     5  .... ...................
     6  ..... ..................
     7  ...... .................
     8  ....... ................
     9  ........ ...............
    10  ......... ..............
    11  .......... .............
    12  ........... ............
    13  ............ ...........
    14  ............. ..........
    15  .............. .........
    16  ............... ........
    17  ................ .......
    18  ................. ......
    19  .................. .....
    20  ................... ....
    21  .................... ...
    22  ..................... ..
    23  ...................... .
    24  ....................... 
Total test intervals with failures = 2 : last failure 20:57:00.733
Max pending rx frames = 6 out of 6


== To get maximum standard Ethernet MTU frames with RDMA UC Queue-Pairs over ROCEv1 ==

The switch under test needs to see the maximum standard MTU without VLAN tags, with an Ethernet payload of 1500.

This can be done with RoCEv1 by setting the UC message size to 1444 and the path MTU to 2048.

The following was run:
$ ~/rdma-core/build/bin/ibv_uc_pingpong -d mlx4_0 -i 2 -g 25 -s 1444 -m 2048
  local address:  LID 0x0000, QPN 0x000262, PSN 0x70d05b, GID fe80::2ff:fe00:19
  eth_mac=02:00:01:00:00:1A  vid=1025
  remote address: LID 0x0000, QPN 0x000263, PSN 0xc43eda, GID fe80::1ff:fe00:1a
2888000 bytes in 0.02 seconds = 954.24 Mbit/sec
1000 iters in 0.02 seconds = 24.21 usec/iter

$ ~/rdma-core/build/bin/ibv_uc_pingpong -d mlx4_0 -i 1 -g 26 localhost -s 1444 -m 2048
  local address:  LID 0x0000, QPN 0x000263, PSN 0xc43eda, GID fe80::1ff:fe00:1a
  remote address: LID 0x0000, QPN 0x000262, PSN 0x70d05b, GID fe80::2ff:fe00:19
  eth_mac=02:00:02:00:00:19  vid=1026
2888000 bytes in 0.02 seconds = 1184.40 Mbit/sec
1000 iters in 0.02 seconds = 19.51 usec/iter

And an injection switch mirror port used to capture the traffic.

Wireshark showed 1518 bytes captured in each RoCEv1 frame containing:
- 14 bytes of Ethernet header - source MAC, destination MAC, Ethertype 802.1Q Virtual LAN (0x8100)
- 4 bytes for VLAN tag - the type is RDMA over Converged Ethernet (0x8915)
- 40 bytes for Infiniband Global Route Header
- 12 bytes for Base Transport Header
- 1444 bytes for the UC message size
- 4 bytes for Invariant CRC

Temporarily changed the injection switch VLAN configuration so that the PSID for port 26 was 1027 rather than 1026.
This caused the ibv_uc_pingpong test to fail to receive any messages. Therefore, Queue-Pair receipt only works if
the frames are received on the VLAN to which the Queue-Pair is bound.

For the switch_test this means any flooded frames shouldn't be received on a Queue-Pair and so the test can't
directly record flooded frames (while the switch under test is learning MAC addresses).

By comparing the change in /sys/class/infiniband/<device>/ports/<port>/counters/port_rcv_packets counters against the
number of frames received, may be able to estimate the number of flooded frames.


== Summary table from ibv_uc_flooded_packets ==

The following is the summary table from running ibv_uc_flooded_packets:

Num    Known  Num      Tx      Last flood
ports  MACs   flooded  frames  iteration   Host port direction option
    2      4        2       8           1  reverse except all port combinations tested
    2      4        2       8           1  reverse exception destination_tested_port_index resets
    2      4        2       8           0  change all port combinations tested
    3      6        3      24           0  reverse except all port combinations tested
    3      5        2      24           0  reverse exception destination_tested_port_index resets
    3      6        6      24           0  change all port combinations tested
    4      8        1      48           0  reverse except all port combinations tested
    4      8        6      48           1  reverse exception destination_tested_port_index resets
    4      8       12      48           0  change all port combinations tested
    5     10        8      80           0  reverse except all port combinations tested
    5     10        2      80           0  reverse exception destination_tested_port_index resets
    5     10       20      80           0  change all port combinations tested
    6     12        1     120           0  reverse except all port combinations tested
    6     12       14     120           1  reverse exception destination_tested_port_index resets
    6     12       30     120           0  change all port combinations tested
    7     14       15     168           0  reverse except all port combinations tested
    7     14        2     168           0  reverse exception destination_tested_port_index resets
    7     14       42     168           0  change all port combinations tested
    8     16        1     224           0  reverse except all port combinations tested
    8     16       26     224           1  reverse exception destination_tested_port_index resets
    8     16       56     224           0  change all port combinations tested
    9     18       24     288           0  reverse except all port combinations tested
    9     18        2     288           0  reverse exception destination_tested_port_index resets
    9     18       72     288           0  change all port combinations tested
   10     20        1     360           0  reverse except all port combinations tested
   10     20       42     360           1  reverse exception destination_tested_port_index resets
   10     20       90     360           0  change all port combinations tested
   11     22       35     440           0  reverse except all port combinations tested
   11     22        2     440           0  reverse exception destination_tested_port_index resets
   11     22      110     440           0  change all port combinations tested
   12     24        1     528           0  reverse except all port combinations tested
   12     24       62     528           1  reverse exception destination_tested_port_index resets
   12     24      132     528           0  change all port combinations tested
   13     26       48     624           0  reverse except all port combinations tested
   13     26        2     624           0  reverse exception destination_tested_port_index resets
   13     26      156     624           0  change all port combinations tested
   14     28        1     728           0  reverse except all port combinations tested
   14     28       86     728           1  reverse exception destination_tested_port_index resets
   14     28      182     728           0  change all port combinations tested
   15     30       63     840           0  reverse except all port combinations tested
   15     30        2     840           0  reverse exception destination_tested_port_index resets
   15     30      210     840           0  change all port combinations tested
   16     32        1     960           0  reverse except all port combinations tested
   16     32      114     960           1  reverse exception destination_tested_port_index resets
   16     32      240     960           0  change all port combinations tested
   17     34       80    1088           0  reverse except all port combinations tested
   17     34        2    1088           0  reverse exception destination_tested_port_index resets
   17     34      272    1088           0  change all port combinations tested
   18     36        1    1224           0  reverse except all port combinations tested
   18     36      146    1224           1  reverse exception destination_tested_port_index resets
   18     36      306    1224           0  change all port combinations tested
   19     38       99    1368           0  reverse except all port combinations tested
   19     38        2    1368           0  reverse exception destination_tested_port_index resets
   19     38      342    1368           0  change all port combinations tested
   20     40        1    1520           0  reverse except all port combinations tested
   20     40      182    1520           1  reverse exception destination_tested_port_index resets
   20     40      380    1520           0  change all port combinations tested
   21     42      120    1680           0  reverse except all port combinations tested
   21     42        2    1680           0  reverse exception destination_tested_port_index resets
   21     42      420    1680           0  change all port combinations tested
   22     44        1    1848           0  reverse except all port combinations tested
   22     44      222    1848           1  reverse exception destination_tested_port_index resets
   22     44      462    1848           0  change all port combinations tested
   23     46      143    2024           0  reverse except all port combinations tested
   23     46        2    2024           0  reverse exception destination_tested_port_index resets
   23     46      506    2024           0  change all port combinations tested
   24     48        1    2208           0  reverse except all port combinations tested
   24     48      266    2208           1  reverse exception destination_tested_port_index resets
   24     48      552    2208           0  change all port combinations tested
   25     50      168    2400           0  reverse except all port combinations tested
   25     50        2    2400           0  reverse exception destination_tested_port_index resets
   25     50      600    2400           0  change all port combinations tested
   26     52        1    2600           0  reverse except all port combinations tested
   26     52      314    2600           1  reverse exception destination_tested_port_index resets
   26     52      650    2600           0  change all port combinations tested
   27     54      195    2808           0  reverse except all port combinations tested
   27     54        2    2808           0  reverse exception destination_tested_port_index resets
   27     54      702    2808           0  change all port combinations tested
   28     56        1    3024           0  reverse except all port combinations tested
   28     56      366    3024           1  reverse exception destination_tested_port_index resets
   28     56      756    3024           0  change all port combinations tested
   29     58      224    3248           0  reverse except all port combinations tested
   29     58        2    3248           0  reverse exception destination_tested_port_index resets
   29     58      812    3248           0  change all port combinations tested
   30     60        1    3480           0  reverse except all port combinations tested
   30     60      422    3480           1  reverse exception destination_tested_port_index resets
   30     60      870    3480           0  change all port combinations tested
   31     62      255    3720           0  reverse except all port combinations tested
   31     62        2    3720           0  reverse exception destination_tested_port_index resets
   31     62      930    3720           0  change all port combinations tested
   32     64        1    3968           0  reverse except all port combinations tested
   32     64      482    3968           1  reverse exception destination_tested_port_index resets
   32     64      992    3968           0  change all port combinations tested
   33     66      288    4224           0  reverse except all port combinations tested
   33     66        2    4224           0  reverse exception destination_tested_port_index resets
   33     66     1056    4224           0  change all port combinations tested
   34     68        1    4488           0  reverse except all port combinations tested
   34     68      546    4488           1  reverse exception destination_tested_port_index resets
   34     68     1122    4488           0  change all port combinations tested
   35     70      323    4760           0  reverse except all port combinations tested
   35     70        2    4760           0  reverse exception destination_tested_port_index resets
   35     70     1190    4760           0  change all port combinations tested
   36     72        1    5040           0  reverse except all port combinations tested
   36     72      614    5040           1  reverse exception destination_tested_port_index resets
   36     72     1260    5040           0  change all port combinations tested
   37     74      360    5328           0  reverse except all port combinations tested
   37     74        2    5328           0  reverse exception destination_tested_port_index resets
   37     74     1332    5328           0  change all port combinations tested
   38     76        1    5624           0  reverse except all port combinations tested
   38     76      686    5624           1  reverse exception destination_tested_port_index resets
   38     76     1406    5624           0  change all port combinations tested
   39     78      399    5928           0  reverse except all port combinations tested
   39     78        2    5928           0  reverse exception destination_tested_port_index resets
   39     78     1482    5928           0  change all port combinations tested
   40     80        1    6240           0  reverse except all port combinations tested
   40     80      762    6240           1  reverse exception destination_tested_port_index resets
   40     80     1560    6240           0  change all port combinations tested
   41     82      440    6560           0  reverse except all port combinations tested
   41     82        2    6560           0  reverse exception destination_tested_port_index resets
   41     82     1640    6560           0  change all port combinations tested
   42     84        1    6888           0  reverse except all port combinations tested
   42     84      842    6888           1  reverse exception destination_tested_port_index resets
   42     84     1722    6888           0  change all port combinations tested
   43     86      483    7224           0  reverse except all port combinations tested
   43     86        2    7224           0  reverse exception destination_tested_port_index resets
   43     86     1806    7224           0  change all port combinations tested
   44     88        1    7568           0  reverse except all port combinations tested
   44     88      926    7568           1  reverse exception destination_tested_port_index resets
   44     88     1892    7568           0  change all port combinations tested
   45     90      528    7920           0  reverse except all port combinations tested
   45     90        2    7920           0  reverse exception destination_tested_port_index resets
   45     90     1980    7920           0  change all port combinations tested
   46     92        1    8280           0  reverse except all port combinations tested
   46     92     1014    8280           1  reverse exception destination_tested_port_index resets
   46     92     2070    8280           0  change all port combinations tested
   47     94      575    8648           0  reverse except all port combinations tested
   47     94        2    8648           0  reverse exception destination_tested_port_index resets
   47     94     2162    8648           0  change all port combinations tested
   48     96        1    9024           0  reverse except all port combinations tested
   48     96     1106    9024           1  reverse exception destination_tested_port_index resets
   48     96     2256    9024           0  change all port combinations tested

This shows the optimum way to change the host port directions to minimum the number of frames which get flooded is:
- "reverse exception destination_tested_port_index resets" when testing an odd number of ports.
- "reverse except all port combinations tested" when testing an even number of ports.
